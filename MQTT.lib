http://mbed.org/teams/mqtt/code/MQTT/#8b2abe9bd814